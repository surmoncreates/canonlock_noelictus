<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Canonlock â€” Noelictus (External JSON)</title>
  <base href="/canonlock_noelictus/">
  <link rel="icon" href="data:,">
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    body{margin:24px;line-height:1.5}
    h1{margin:0 0 8px}
    #status{padding:8px 10px;border-radius:8px;background:#f5f5f7;display:inline-block;margin-bottom:12px}
    pre{background:#0b0b0c;color:#e9e9ef;padding:14px;border-radius:12px;overflow:auto}
  </style>
</head>
<body>
  <h1>ðŸ“š Canonlock â€” Noelictus</h1>
  <div id="status">Loading registryâ€¦</div>
  <pre id="out"></pre>

  <script>
  (async () => {
    try {
      // 1) Load registry.json from data folder
      const regRes = await fetch("data/canonlock_registry.json", { cache: "no-store" });
      if (!regRes.ok) throw new Error(`Registry HTTP ${regRes.status}`);
      const registry = await regRes.json();

      // 2) Validate and pick first bundle
      const bundles = Array.isArray(registry?.bundles) ? registry.bundles : [];
      if (bundles.length === 0) throw new Error("No bundles defined in registry");
      const first = bundles[0];

      // 3) Load anchors + reactions JSON from paths defined in registry
      const [aRes, rRes] = await Promise.all([
        fetch(first.anchors, { cache: "no-store" }),
        fetch(first.reactions, { cache: "no-store" })
      ]);
      if (!aRes.ok) throw new Error(`Anchors HTTP ${aRes.status}`);
      if (!rRes.ok) throw new Error(`Reactions HTTP ${rRes.status}`);

      const anchors = await aRes.json();
      const reactions = await rRes.json();

      // 4) Show success + loaded data
      document.getElementById("status").textContent = "Loaded âœ“ (external JSON mode)";
      document.getElementById("out").textContent =
        JSON.stringify({ registry, anchors, reactions }, null, 2);

    } catch (err) {
      console.error(err);
      document.getElementById("status").textContent = "Failed to load: " + err.message;
    }
  })();
  </script>
</body>
</html>
