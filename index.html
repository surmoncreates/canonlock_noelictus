<script>
(async () => {
  try {
    // Fetch registry (no cache so you always see latest)
    const res = await fetch("https://surmoncreates.github.io/canonlock_noelictus/data/canonlock_registry.json", { cache: "no-store" });
    if (!res.ok) throw new Error(Registry HTTP ${res.status});
    const registry = await res.json();

    // Defensive check
    const bundles = Array.isArray(registry?.bundles) ? registry.bundles : [];
    if (bundles.length === 0) throw new Error("No bundles defined in registry");

    // Resolve anchors + reactions URLs against your Pages base
    const BASE = "https://surmoncreates.github.io/canonlock_noelictus/";
    const first = bundles[0];

    const anchorsURL   = new URL(first.anchors,   BASE).toString();
    const reactionsURL = new URL(first.reactions, BASE).toString();

    // Fetch anchors + reactions (no cache)
    const [anchorsRes, reactionsRes] = await Promise.all([
      fetch(anchorsURL,   { cache: "no-store" }),
      fetch(reactionsURL, { cache: "no-store" })
    ]);
    if (!anchorsRes.ok)   throw new Error(Anchors HTTP ${anchorsRes.status});
    if (!reactionsRes.ok) throw new Error(Reactions HTTP ${reactionsRes.status});

    const anchors   = await anchorsRes.json();
    const reactions = await reactionsRes.json();

    //  SUCCESS UI
    document.getElementById("status").textContent = "Loaded âœ“";
    document.getElementById("out").textContent = JSON.stringify({ bundles, anchors, reactions }, null, 2);

    // TODO: replace the line above with your real render/init that uses anchors and reactions

  } catch (err) {
    console.error(err);
    //  ERROR UI
    document.getElementById("status").textContent = "Failed to load: " + err;
  }
})();
</script>
</html>.)
